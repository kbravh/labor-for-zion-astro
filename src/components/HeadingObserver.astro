<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tocLinks = document.querySelectorAll(
      'nav#table-of-contents a[href^="#"]'
    );

    const observer = new IntersectionObserver(
      entries => {
        const intersectingEntries = entries
          .filter(entry => entry.isIntersecting)
          .sort((a, b) => b.boundingClientRect.top - a.boundingClientRect.top);
        intersectingEntries.forEach(entry => {
          if (entry.isIntersecting) {
            tocLinks.forEach(link => {
              link.classList.remove('!text-emerald-500');
              link.classList.remove('font-bold');
            });
            const activeLink = document.querySelector(
              `nav a[href='#${entry.target.id}']`
            );
            if (activeLink) {
              activeLink.classList.add('!text-emerald-500');
              activeLink.classList.add('font-bold');
            }
          }
        });
      },
      {
        threshold: 0.5,
      }
    );

    document
      .querySelectorAll(
        '#article-body h2, #article-body h3, #article-body h4, #article-body h5, #article-body h6'
      )
      .forEach(heading => {
        observer.observe(heading);
      });
  });
</script>
